<?php
set_time_limit(0);
H::includeFromLib('Utils');

function insert_opzione($id_nazione, $opzione_nome, $opzione_descrizione) {
	$params = [
		':nome' => 'Spedizione prioritaria',
		':tipo' => 1
	];

	$strQry = ' NAZIONE_SERVIZIO_GRUPPO SET 
		NOME = :nome, 
		TIPO = :tipo';
	$strQry = 'INSERT INTO ' . $strQry . ', ID_NAZIONE = :id_nazione';
	$params[':id_nazione'] = $id_nazione;

	$ps = H::db()->prepare($strQry);
	$ps->execute($params);
	$id = H::db()->lastInsertId();

	$default_lang = H::config('default_language', 'it');
	$langs = H::config('enabled_languages', null);
	if ($langs == null) {
		$langs = [$default_lang];
	}

	$psNazSer = H::db()->prepare('INSERT INTO NAZIONE_SERVIZIO SET PREZZO = :prezzo, ID_NAZIONE_SERVIZIO_GRUPPO = :id_nazione_servizio_gruppo');
	$psNazSerLang = H::db()->prepare('INSERT INTO NAZIONE_SERVIZIO_LANG SET NOME = :nome, DETTAGLIO_LANG = :dettaglio, ID_NAZIONE_SERVIZIO = :id, LANG = :lang');

	$params = [
		':id_nazione_servizio_gruppo' => $id,
		':prezzo' => 0,
	];
	$psNazSer->execute($params);
	$ide_new = H::db()->lastInsertId();
	foreach ($langs as $lang) {
		$params = [
			':id' => $ide_new,
			':lang' => $lang,
			':nome' => $opzione_nome[$lang],
			':dettaglio' => json_encode([
				'descrizione' => $opzione_descrizione[$lang]
			]),
		];
		$psNazSerLang->execute($params);
	}
}

$list = [
"40;30;5;45;5;65;10;110;20;160;35",
"14;50;5;75;5;115;10;180;25;250;50",
"38;50;5;75;5;115;10;180;25;250;50",
"64;50;5;75;5;115;10;180;25;250;50",
"99;50;5;75;5;115;10;180;25;250;50",
"103;50;5;75;5;115;10;180;25;250;50",
"110;50;5;75;5;115;10;180;25;250;50",
"118;50;5;75;5;115;10;180;25;250;50",
"127;50;5;75;5;115;10;180;25;250;50",
"131;50;5;75;5;115;10;180;25;250;50",
"140;50;5;75;5;115;10;180;25;250;50",
"156;50;5;75;5;115;10;180;25;250;50",
"172;50;5;75;5;115;10;180;25;250;50",
"195;50;5;75;5;115;10;180;25;250;50",
"202;50;5;75;5;115;10;180;25;250;50",
"212;50;5;75;5;115;10;180;25;250;50",
"215;50;5;75;5;115;10;180;25;250;50",
"235;50;5;75;5;115;10;180;25;250;50",
"4;50;5;80;5;115;15;185;25;255;45",
"18;50;5;80;5;115;15;185;25;255;45",
"19;50;5;80;5;115;15;185;25;255;45",
"26;50;5;80;5;115;15;185;25;255;45",
"34;50;5;80;5;115;15;185;25;255;45",
"66;50;5;80;5;115;15;185;25;255;45",
"102;50;5;80;5;115;15;185;25;255;45",
"107;50;5;80;5;115;15;185;25;255;45",
"111;50;5;80;5;115;15;185;25;255;45",
"116;50;5;80;5;115;15;185;25;255;45",
"120;50;5;80;5;115;15;185;25;255;45",
"123;50;5;80;5;115;15;185;25;255;45",
"147;50;5;80;5;115;15;185;25;255;45",
"152;50;5;80;5;115;15;185;25;255;45",
"164;50;5;80;5;115;15;185;25;255;45",
"165;50;5;80;5;115;15;185;25;255;45",
"167;50;5;80;5;115;15;185;25;255;45",
"177;50;5;80;5;115;15;185;25;255;45",
"190;50;5;80;5;115;15;185;25;255;45",
"204;50;5;80;5;115;15;185;25;255;45",
"220;50;5;80;5;115;15;185;25;255;45",
"227;50;5;80;5;115;15;185;25;255;45",
"8;55;5;80;10;120;15;190;25;270;40",
"10;55;5;80;10;120;15;190;25;270;40",
"11;55;5;80;10;120;15;190;25;270;40",
"13;55;5;80;10;120;15;190;25;270;40",
"17;55;5;80;10;120;15;190;25;270;40",
"20;55;5;80;10;120;15;190;25;270;40",
"23;55;5;80;10;120;15;190;25;270;40",
"25;55;5;80;10;120;15;190;25;270;40",
"28;55;5;80;10;120;15;190;25;270;40",
"32;55;5;80;10;120;15;190;25;270;40",
"42;55;5;80;10;120;15;190;25;270;40",
"45;55;5;80;10;120;15;190;25;270;40",
"49;55;5;80;10;120;15;190;25;270;40",
"54;55;5;80;10;120;15;190;25;270;40",
"62;55;5;80;10;120;15;190;25;270;40",
"63;55;5;80;10;120;15;190;25;270;40",
"65;55;5;80;10;120;15;190;25;270;40",
"67;55;5;80;10;120;15;190;25;270;40",
"77;55;5;80;10;120;15;190;25;270;40",
"88;55;5;80;10;120;15;190;25;270;40",
"89;55;5;80;10;120;15;190;25;270;40",
"91;55;5;80;10;120;15;190;25;270;40",
"94;55;5;80;10;120;15;190;25;270;40",
"95;55;5;80;10;120;15;190;25;270;40",
"98;55;5;80;10;120;15;190;25;270;40",
"109;55;5;80;10;120;15;190;25;270;40",
"136;55;5;80;10;120;15;190;25;270;40",
"146;55;5;80;10;120;15;190;25;270;40",
"157;55;5;80;10;120;15;190;25;270;40",
"168;55;5;80;10;120;15;190;25;270;40",
"170;55;5;80;10;120;15;190;25;270;40",
"171;55;5;80;10;120;15;190;25;270;40",
"176;55;5;80;10;120;15;190;25;270;40",
"183;55;5;80;10;120;15;190;25;270;40",
"184;55;5;80;10;120;15;190;25;270;40",
"186;55;5;80;10;120;15;190;25;270;40",
"200;55;5;80;10;120;15;190;25;270;40",
"206;55;5;80;10;120;15;190;25;270;40",
"219;55;5;80;10;120;15;190;25;270;40",
"223;55;5;80;10;120;15;190;25;270;40",
"231;55;5;80;10;120;15;190;25;270;40",
"234;55;5;80;10;120;15;190;25;270;40",
"236;55;5;80;10;120;15;190;25;270;40",
"237;55;5;80;10;120;15;190;25;270;40",
"43;90;100;110;160;150;250;230;580;230;580",
"50;90;100;110;160;150;250;230;580;230;580",
"57;90;100;110;160;150;250;230;580;230;580",
"68;90;100;110;160;150;250;230;580;230;580",
"72;90;100;110;160;150;250;230;580;230;580",
"247;40;50;50;50;60;60;105;105;160;140",
"93;90;100;110;160;150;250;230;350;230;580",
"104;90;100;110;160;150;250;230;350;230;580",
"246;40;50;50;50;60;60;105;105;160;140",
"114;90;100;110;160;150;250;230;350;230;580",
"115;90;100;110;160;150;250;230;350;230;580",
"245;40;50;50;50;60;60;105;105;160;140",
"139;90;100;110;160;150;250;230;350;230;580",
"149;90;100;110;160;150;250;230;350;230;580",
"151;90;100;110;160;150;250;230;350;230;580",
"160;90;100;110;160;150;250;230;350;230;580",
"162;75;100;90;120;125;220;190;300;390;580",
"178;90;100;110;160;150;250;230;350;230;580",
"182;90;100;110;160;150;250;230;350;230;580",
"189;90;100;110;160;150;250;230;350;230;580",
"194;90;100;110;160;150;250;230;350;230;580",
"198;90;100;110;160;150;250;230;350;230;580",
"199;90;100;110;160;150;250;230;350;230;580",
"205;90;100;110;160;150;250;230;350;230;580",
"211;75;100;90;120;125;220;190;300;390;300",
"213;90;100;110;160;150;250;230;350;230;580",
"224;90;100;110;160;150;250;230;350;230;580",
"240;75;100;90;120;125;220;190;300;390;300",
"2;85;5;120;10;170;25;270;40;370;70",
"5;85;5;120;10;170;25;270;40;370;70",
"7;85;5;120;10;170;25;270;40;370;70",
"12;85;5;120;10;170;25;270;40;370;70",
"16;85;5;120;10;170;25;270;40;370;70",
"24;85;5;120;10;170;25;270;40;370;70",
"30;85;5;120;10;170;25;270;40;370;70",
"36;85;5;120;10;170;25;270;40;370;70",
"37;85;5;120;10;170;25;270;40;370;70",
"39;85;5;120;10;170;25;270;40;370;70",
"41;85;5;120;10;170;25;270;40;370;70",
"44;85;5;120;10;170;25;270;40;370;70",
"51;85;5;120;10;170;25;270;40;370;70",
"52;85;5;120;10;170;25;270;40;370;70",
"53;85;5;120;10;170;25;270;40;370;70",
"55;85;5;120;10;170;25;270;40;370;70",
"61;85;5;120;10;170;25;270;40;370;70",
"69;85;5;120;10;170;25;270;40;370;70",
"71;85;5;120;10;170;25;270;40;370;70",
"74;85;5;120;10;170;25;270;40;370;70",
"78;85;5;120;10;170;25;270;40;370;70",
"80;85;5;120;10;170;25;270;40;370;70",
"81;85;5;120;10;170;25;270;40;370;70",
"82;85;5;120;10;170;25;270;40;370;70",
"84;85;5;120;10;170;25;270;40;370;70",
"90;85;5;120;10;170;25;270;40;370;70",
"92;85;5;120;10;170;25;270;40;370;70",
"105;85;5;120;10;170;25;270;40;370;70",
"112;85;5;120;10;170;25;270;40;370;70",
"113;85;5;120;10;170;25;270;40;370;70",
"117;85;5;120;10;170;25;270;40;370;70",
"121;85;5;120;10;170;25;270;40;370;70",
"122;85;5;120;10;170;25;270;40;370;70",
"129;85;5;120;10;170;25;270;40;370;70",
"130;85;5;120;10;170;25;270;40;370;70",
"132;85;5;120;10;170;25;270;40;370;70",
"133;85;5;120;10;170;25;270;40;370;70",
"135;85;5;120;10;170;25;270;40;370;70",
"137;85;5;120;10;170;25;270;40;370;70",
"138;85;5;120;10;170;25;270;40;370;70",
"141;85;5;120;10;170;25;270;40;370;70",
"144;85;5;120;10;170;25;270;40;370;70",
"148;85;5;120;10;170;25;270;40;370;70",
"150;85;5;120;10;170;25;270;40;370;70",
"155;85;5;120;10;170;25;270;40;370;70",
"158;85;5;120;10;170;25;270;40;370;70",
"159;85;5;120;10;170;25;270;40;370;70",
"166;85;5;120;10;170;25;270;40;370;70",
"169;85;5;120;10;170;25;270;40;370;70",
"181;85;5;120;10;170;25;270;40;370;70",
"187;85;5;120;10;170;25;270;40;370;70",
"191;85;5;120;10;170;25;270;40;370;70",
"193;85;5;120;10;170;25;270;40;370;70",
"208;85;5;120;10;170;25;270;40;370;70",
"214;85;5;120;10;170;25;270;40;370;70",
"216;85;5;120;10;170;25;270;40;370;70",
"218;85;5;120;10;170;25;270;40;370;70",
"225;85;5;120;10;170;25;270;40;370;70",
"232;85;5;120;10;170;25;270;40;370;70",
"233;85;5;120;10;170;25;270;40;370;70",
"238;85;5;120;10;170;25;270;40;370;70",
"242;85;5;120;10;170;25;270;40;370;70",
"243;85;5;120;10;170;25;270;40;370;70",
"46;50;5;75;5;110;15;175;25;245;45",
"229;30;5;45;5;65;5;105;15;155;30",
"97;0;15;0;15;0;30;0;30;0;30",
"108;0;15;0;15;0;30;0;30;0;30",
"188;0;15;0;15;0;30;0;30;0;30",
"22;15;10;25;10;35;10;55;15;65;25",
"76;15;10;25;10;35;10;55;15;65;25",
"126;15;10;25;10;35;10;55;15;65;25",
"143;15;10;25;10;35;10;55;15;65;25",
"153;15;10;25;10;35;10;55;15;65;25",
"228;15;10;25;10;35;10;55;15;65;25",
"6;15;10;25;10;35;10;55;15;65;25",
"15;15;10;25;10;35;10;55;15;65;25",
"60;15;10;25;10;35;10;55;15;65;25",
"73;15;10;25;10;35;10;55;15;65;25",
"75;15;10;25;10;35;10;55;15;65;25",
"83;15;10;25;10;35;10;55;15;65;25",
"86;15;10;25;10;35;10;55;15;65;25",
"87;15;10;25;10;35;10;55;15;65;25",
"106;15;10;25;10;35;10;55;15;65;25",
"175;15;10;25;10;35;10;55;15;65;25",
"203;15;10;25;10;35;10;55;15;65;25",
"209;15;10;25;10;35;10;55;15;65;25",
"244;40;10;45;10;60;10;75;10;100;20",
"35;30;5;40;10;55;25;80;80;90;160",
"58;30;5;40;10;55;25;80;80;90;160",
"59;30;5;40;10;55;25;80;80;90;160",
"70;30;5;40;10;55;25;80;80;90;160",
"100;30;5;40;10;55;25;80;80;90;160",
"119;30;5;40;10;55;25;80;80;90;160",
"125;30;5;40;10;55;25;80;80;90;160",
"134;30;5;40;10;55;25;80;80;90;160",
"174;30;5;40;10;55;25;80;80;90;160",
"179;30;5;40;10;55;25;80;80;90;160",
"196;30;5;40;10;55;25;80;80;90;160",
"197;30;5;40;10;55;25;80;80;90;160",
"85;25;5;35;5;50;10;75;25;95;35",
"101;25;5;35;5;50;10;75;25;95;35",
"124;25;5;35;5;50;10;75;25;95;35",
"163;25;5;35;5;50;10;75;25;95;35",
"210;25;5;35;5;50;10;75;25;95;35",
"3;55;10;80;20;120;15;190;20;250;40",
"27;55;10;80;20;120;15;190;20;250;40",
"29;55;10;80;20;120;15;190;20;250;40",
"56;55;10;80;20;120;15;190;20;250;40",
"128;55;10;80;20;120;15;190;20;250;40",
"142;55;10;80;20;120;15;190;20;250;40",
"145;55;10;80;20;120;15;190;20;250;40",
"180;55;10;80;20;120;15;190;20;250;40",
"192;55;10;80;20;120;15;190;20;250;40",
"221;55;10;80;20;120;15;190;20;250;40",
"226;55;10;80;20;120;15;190;20;250;40",

];

$opzione_nome = [
	'it' => 'Spedizione prioritaria',
	'en' => 'Priority shipping',
	'es' => 'Envío prioritario',
];
foreach ($list as $elem) {
	$elem = explode(';', $elem);
	$id_nazione = $elem[0];
	$from = 1;
	$from = 2;
	$ps = H::db()->prepare('SELECT * FROM NAZIONE WHERE ID = :id');
	$ps->execute([
		':id' => $id_nazione
	]);
	if ($row = $ps->fetch()) {
		$from = 5;
		$to = 6;
		
		switch($row['CONTINENTE']) {
		case 0: //europa
			$from = 3;
			$to = 4;
			break;
		}
		if ($id_nazione == 108 || $id_nazione == 188) {
			$from = 2;
			$to = 3;			
		}
		elseif ($id_nazione == 40 || $id_nazione == 2) {
			$from = 4;
			$to = 5;			
		}
		
		$dettaglio = (array)json_decode($row['DETTAGLIO'], true);
		if ($id_nazione == 108 || $id_nazione == 188) {
			$dettaglio['descrizione'] = 'Spedizione economy, iorni lavorativi di consegna da ' . $from . ' a ' . $to;
		}
		else {
			$dettaglio['descrizione'] = 'Economy shipping, delivery workdays from ' . $from . ' to ' . $to;
		}
		
		$from = 3;
		$to = 4;
		
		switch($row['CONTINENTE']) {
		case 0: //europa
			$from = 1;
			$to = 2;
			break;
		}
		if ($id_nazione == 108 || $id_nazione == 188) {
			$from = 1;
			$to = 2;			
		}
		elseif ($id_nazione == 40 || $id_nazione == 2) {
			$from = 2;
			$to = 3;			
		}
		
		$dettaglio['prezzo_a'] = $elem[1];
		$dettaglio['prezzo_b'] = $elem[3];
		$dettaglio['prezzo_c'] = $elem[5];
		$dettaglio['prezzo_d'] = $elem[7];
		$dettaglio['prezzo_e'] = $elem[9];
		$dettaglio['prezzo_a_p'] = intval($elem[1]) + intval($elem[2]);
		$dettaglio['prezzo_b_p'] = intval($elem[3]) + intval($elem[4]);
		$dettaglio['prezzo_c_p'] = intval($elem[5]) + intval($elem[6]);
		$dettaglio['prezzo_d_p'] =intval( $elem[7]) + intval($elem[8]);
		$dettaglio['prezzo_e_p'] =intval( $elem[9]) + intval($elem[10]);
		
		$dettaglio = json_encode($dettaglio);
		$ps = H::db()->prepare('UPDATE NAZIONE SET DETTAGLIO = :dettaglio WHERE ID = :id');
		$ps->execute([
			':dettaglio' => $dettaglio,
			':id' => $id_nazione
		]);
	}
	$opzione_descrizione = [
		'it' => 'Giorni lavorativi di consegna da ' . $from . ' a ' . $to,
		'en' => 'Delivery workdays from ' . $from . ' to ' . $to,
		'es' => 'Días laborables de entrega del ' . $from . ' al ' . $to,
	];
	insert_opzione($id_nazione, $opzione_nome, $opzione_descrizione);
	echo $id_nazione . "\n";
}